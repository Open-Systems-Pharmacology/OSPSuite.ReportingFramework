---
title: "Plot-Creation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Plot-Creation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ospsuite.reportingframework)
```
## Configuration of Plots

The plot configuration excel file has two sheets ("DataGroups" and "Outputs") which are used for all plotting functions. Here properties like display names, units, colors,.. are set for outputs and data groups. The identifiers corresponds to the columns "group" and "outputPathId" of the observed data.

## Using runPlot

The `runPlot` function is the primary interface for generating plots within the workflow. It takes the following key parameters:
 - `nameOfplotFunction`: The name of the  plot function to execute. For example, `"ploTimeProfiles"` for the TimeProfile plot.
 - `projectConfiguration`: The configuration object that contains project settings and paths.
 - `inputs`: A list of additional inputs required by the specific plot function.
 
 ### Example:
 
```{r,echo=TRUE,eval=FALSE}
runPlot(
  nameOfplotFunction = "TimeProfiles",
  projectConfiguration = projectConfiguration,
  configTableSheet = "TimeProfiles",
  inputs = list(
    dataObserved = dataObserved
  )
)
```


In this example, the TimeProfile plot is generated using the specified configuration and observed data. The resulting `.Rmd` file will be created in the designated output folder.


## Creating Custom Plot Functions

Custom plot functions allow you to generate specific visualizations tailored to your analysis needs. Each plot function should create an R Markdown (`.Rmd`) file, enabling seamless integration with the existing reporting framework.

## Accessing the Plot Template

To facilitate the creation of custom plot functions, you can open a template using the RStudio Addins. Navigate to the Addins menu in RStudio and select "Open Template Plotfunction". Alternatively, you can use the following function to open the template directly:

```{r,echo=TRUE,eval=FALSE}
openFigureTemplate()
```

This will provide you with a pre-structured template to help you get started with your custom plot function.



## Calling the Custom Plot Function

Once you have defined your custom plot function, you can call it using the `runPlot` interface. For example:

```{r,echo=TRUE,eval=FALSE}
runPlot(
  nameOfplotFunction = "myPlotFunction",
  subfolder = "MyCustomPlots",
  projectConfiguration = projectConfiguration,
  inputs = list() # Additional inputs can be passed as needed
)
```

### Difference Between Custom and Default Plot Function Calls

- **Custom Plot Functions**: When using a custom plot function, you set `functionKey` to `NULL` and directly specify the `plotFunction` parameter with your custom function. 

 - **Default Plot Functions**: For default plot functions, you typically provide a `functionKey` that corresponds to a predefined plot function. The `runPlot` function then uses this key to determine which plot to execute.

## Conclusion

By following this guide, you can create custom plot functions that integrate seamlessly with the workflow. This flexibility allows you to tailor your visualizations and reports to meet the specific needs of your analysis.


# Report Generation

 After generating the plots, the workflow can compile these plots into a comprehensive report. The report is also generated in R Markdown format, allowing for flexible formatting and easy updates.

The first step of the report generation is typically handled by the `mergeRmds` function, which combines multiple `.Rmd` files into a single report document. This allows users to compile results from different plot functions into one cohesive document.

```{r,echo=TRUE,eval=FALSE}
mergeRmds(
  projectConfiguration = projectConfiguration,
  newName = "appendix",
  title = "Appendix",
  sourceRmds = c("Demographics", "TimeProfile", "PKParameter", "DDIRatio", "myFigures")
)
```

In this example, the `mergeRmds` function combines several R Markdown files into a single report titled "Appendix". This report can then be rendered into various formats, such as HTML or Word.


## Converting R Markdown to Word Documents

The `renderWord` function takes an R Markdown file and generates a Word document using the specified conversion template. This allows users to create well-formatted reports that can be easily shared and presented.

### Key Parameters:
 - `fileName`: The name of the `.Rmd` file to convert to Word format.
 - `wordConversionTemplate`: An optional template used for the conversion. If not provided, a default template will be used.
 - `doAppendDocToTemplate`: A boolean value that, if `TRUE`, appends the newly generated document to the specified template after a designated bookmark (`REPORTBLOCK`).
 - `customStyles`: A list of custom styles for figure and table captions and footnotes. The styles should be defined in the `wordConversionTemplate`.

### Example:

```{r,echo=TRUE,eval=FALSE}
renderWord(
  fileName = "myReport.Rmd",
  wordConversionTemplate = "path/to/template/myTemplate.docx",
  customStyles = list(FigureFootnote = "myFootnoteFormat", TableFootnote = "myFootnoteFormat")
)
```

In this example, the `renderWord` function converts the specified R Markdown file into a Word document, applying the custom styles defined for footnotes.

### Additional Functionality:
 The `appendDocToTemplate` function allows the generated Word document to be seamlessly integrated into a pre-defined template. This is particularly useful for maintaining consistent formatting and layout across multiple reports.

## Conclusion:

The plotting functionality and report generation capabilities within this workflow provide a powerful way to visualize and document your analysis results. By leveraging R Markdown, users can create dynamic, reproducible reports that effectively communicate their findings.
The `renderWord` function provides an efficient way to generate professional-quality reports from R Markdown files, facilitating easy documentation and sharing of analysis results.
